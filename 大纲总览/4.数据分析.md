# 数据分析（Pandas 全流程）

## 1. 数据导入与导出

### 1.1 CSV
- `pd.read_csv()`
- `df.to_csv()`
- `parse_dates=['date']`（读取时转换日期）

### 1.2 JSON
- `pd.read_json()`
- `json.load()`
- 嵌套 JSON 转 DataFrame：`pd.DataFrame(data['users'])`

### 1.3 读取后的数据检查
- `df.info()`
- `df.tail()`

---

## 2. 缺失值处理（NaN / None / pd.NA）

### 2.1 缺失值检测
- `isna()` / `isnull()`
- `df.isna().sum(axis=0)`
- `Series.isna().sum()`

### 2.2 删除缺失值
- `dropna()`：删除整行
- `dropna(how="all")`
- `dropna(thresh=n)`
- `dropna(axis=1)` 删除列

### 2.3 填充缺失值
- `fillna({"col": value})`
- `fillna(df.mean())`
- `ffill()` 前向填充
- `bfill()` 后向填充

---

## 3. 时间数据处理（Timestamp / datetime）

### 3.1 Timestamp 属性与方法
- 年月日：`.year .month .day`
- 时分秒：`.hour .minute .second`
- `.quarter`
- `.is_month_end`
- `day_name()`

### 3.2 周期 Period 转换
- `to_period("D")` → 日
- `to_period("M")` → 月
- `to_period("Q")` → 季
- `to_period("Y")` → 年

### 3.3 字符串转日期
- `pd.to_datetime()`

### 3.4 DataFrame 日期列处理
- `df["datetime"] = pd.to_datetime(df["date"])`
- `.dt.year`, `.dt.day_name()` 等

### 3.5 日期作为索引
- `df.set_index("date")`
- `df.loc["2013-01":"2013-02"]`

### 3.6 时间间隔计算
- Timestamp 相减 → `Timedelta`
- `df["delta"] = df["date"] - df["date"][0]`

---

## 4. 重新采样（Resample）

### 4.1 设置日期为索引
- `df.set_index("date", inplace=True)`

### 4.2 常用频率
- `"MS"`：月初
- `"YE"`：年末
- `"W"`：周

### 4.3 重采样操作
- `df[["temp_max","temp_min"]].resample("MS").mean()`
- `df.resample("YE").mean()`

---

## 5. 重复值处理
- `duplicated()` 检查重复行
- `drop_duplicates()` 删除重复
- `keep="last"` 保留最后出现

---

## 6. 数据类型转换

### 6.1 astype() 类型转换
- `int16`
- `category`
- `float` / `int`

### 6.2 map() 映射新特征
- `df["is_male"] = df["gender"].map({"Female": True, "Male": False})`

---

## 7. 数据变形（宽表 / 长表）

### 7.1 行列转置
- `df.T`

### 7.2 宽表 → 长表
- `pd.melt(id_vars=["ID", "name"], var_name="科目", value_name="分数")`

### 7.3 长表 → 宽表
- `pd.pivot(index=["ID", "name"], columns="科目", values="分数")`

### 7.4 字符串分列
- `str.split(" ", expand=True)`
- 分隔血压 `"120/80"`  
  - `df[["high","low"]] = str.split("/", expand=True)`
  - 高低压转 int

### 7.5 rename / set_index / reset_index
- `df.rename(columns={...})`
- `df.set_index(...)`
- `df.reset_index()`

---

## 8. 数据分箱（cut / qcut）
- `pd.cut()`（bins=3）
- `pd.cut(bins=[0, 10000, 20000, 30000])`
- `labels=["低","中","高"]`
- `qcut()` 等频分箱
- 用途示例：员工收入分段 / 睡眠质量分段

---

## 9. 分组聚合（groupby）

### 9.1 基础操作
- `groupby("col").groups`
- `get_group()`

### 9.2 单字段分组
- `df.groupby("department_id")["salary"].mean()`

### 9.3 多字段分组
- `df.groupby(["department_id","job_id"])["salary"].mean()`

### 9.4 多指标聚合
- `df.groupby([...]).agg({"body_mass_g": ["mean","count"]})`

---

## 10. 综合案例：企鹅数据分析
- 数据清洗：`dropna()`
- 类型转换：`sex → category`
- 构造特征：`bill_ratio = bill_length_mm / bill_depth_mm`
- 体重分箱：`body_mass_g → ["低","中","高"]`
- 多字段 groupby 分析（性别 × 岛屿）

---

## 11. 综合案例：睡眠数据分析
- 缺失值清洗（删除 sleep_disorder 等）
- 特征构造：gender / occupation / bmi_category → category
- 血压拆分：high / low
- 分箱：sleep_quality / age
- 分组统计：age_level × bmi_category
